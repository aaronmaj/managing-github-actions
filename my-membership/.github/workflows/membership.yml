name: Memebreship Management Pipeline
on:
    push:
        branches: [ main ]
        paths:
            - 'src/features/membership/**

    workflow_dispatch:

jobs:
    security:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Run security scan
              uses: aquasecurity/trivy-action@master
              with:
                  scan-type: 'fs'
                  ignore-unfixed: true
                  severity: 'CRITICAL, HIGH'

    build:
        needs: security
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '20.x'
                  cache: 'npm'

            - name: Install dependencies
              run: |
                rm -rf node_modules package-lock.json
                npm install


            - name: Run lint
              run: NODE_OPTIONS='--experimental-vm-modules' npm run lint

            - name: Run tests
              run: npm test